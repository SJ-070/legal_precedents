# ê´€ì„¸ë²• íŒë¡€ ê¸°ë°˜ ì±—ë´‡ (Customs Law Case-Based Chatbot)

## í”„ë¡œì íŠ¸ ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” ê´€ì„¸ë²• íŒë¡€ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ AI ë²•ë¥  ì±—ë´‡ì…ë‹ˆë‹¤. Googleì˜ Gemini 2.5 Flash ëª¨ë¸ê³¼ Character n-gram TF-IDF ë²¡í„°í™”ë¥¼ ê²°í•©í•œ í•˜ì´ë¸Œë¦¬ë“œ êµ¬ì¡°ë¡œ, ì‚¬ìš©ìì˜ ë²•ë¥  ê´€ë ¨ ì§ˆë¬¸ì— ëŒ€í•´ ì „ë¬¸ì ì¸ ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤.

## ì±—ë´‡ ë‹µë³€ ìƒì„± ê³¼ì • (ìƒì„¸)

ì´ ì„¹ì…˜ì€ ì‚¬ìš©ìê°€ ì§ˆë¬¸ì„ ì…ë ¥í•œ í›„ ì±—ë´‡ì´ ë‹µë³€ì„ ìƒì„±í•˜ëŠ” ì „ì²´ ê³¼ì •ì„ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.

### Phase 0: ì´ˆê¸°í™” (ì•± ì‹œì‘ ì‹œ 1íšŒë§Œ)

**Step 0-1: ë°ì´í„° íŒŒì¼ ë¡œë“œ**
- `data_kcs.json` ì½ê¸° (423ê±´ì˜ ê´€ì„¸ì²­ íŒë¡€)
- `data_moleg.json` ì½ê¸° (486ê±´ì˜ êµ­ê°€ë²•ë ¹ì •ë³´ì„¼í„° íŒë¡€)
- ì´ 909ê±´ì˜ íŒë¡€ ë°ì´í„° ë¡œë“œ

**Step 0-2: ë²¡í„°í™” ìºì‹œ í™•ì¸**
- íŒŒì¼ ìˆ˜ì • ì‹œê°„ ê¸°ë°˜ MD5 í•´ì‹œë¡œ ìºì‹œ í‚¤ ìƒì„±
- `vectorization_cache.pkl.gz` íŒŒì¼ ì¡´ì¬ í™•ì¸

**Case A: ìºì‹œ ìˆìŒ** (2íšŒì°¨ ì´í›„)
- GZIP ì••ì¶•ëœ Pickle íŒŒì¼ì—ì„œ ë²¡í„°í™” ê²°ê³¼ ë¡œë“œ
- ì†Œìš” ì‹œê°„: ì•½ 0.5ì´ˆ
- ë²¡í„°í™” ê³¼ì • ê±´ë„ˆë›°ê³  ì¦‰ì‹œ ì‚¬ìš©

**Case B: ìºì‹œ ì—†ìŒ** (ìµœì´ˆ ì‹¤í–‰)

**Step 0-3: ë°ì´í„° í†µí•©**
```python
all_data = kcs_data + moleg_data  # 909ê±´ í†µí•©
data_sources = ['kcs', 'kcs', ..., 'moleg', 'moleg', ...]
```

**Step 0-4: í…ìŠ¤íŠ¸ ì¶”ì¶œ**
- KCS ë°ì´í„°: ì‚¬ê±´ë²ˆí˜¸, ì„ ê³ ì¼ì, íŒê²°ì£¼ë¬¸, ì²­êµ¬ì·¨ì§€, íŒê²°ì´ìœ  ì¶”ì¶œ
- MOLEG ë°ì´í„°: ì œëª©, íŒê²°ìš”ì§€(50% ê°€ì¤‘ì¹˜), ë‚´ìš© ë“± ì¶”ì¶œ

**Step 0-5: Character n-gram ë²¡í„°í™”**
```python
vectorizer = TfidfVectorizer(
    analyzer='char',        # ê¸€ì ë‹¨ìœ„ ë¶„ì„
    ngram_range=(2, 4),     # 2~4ê¸€ì ì¡°í•©
    max_features=50000,     # ìµœëŒ€ 5ë§Œê°œ íŠ¹ì§•
    max_df=0.9,             # 90% ì´ìƒ ë¬¸ì„œ ë“±ì¥ ì‹œ ì œì™¸
    sublinear_tf=True       # ë¡œê·¸ ìŠ¤ì¼€ì¼ë§
)
tfidf_matrix = vectorizer.fit_transform(corpus)
# ê²°ê³¼: (909, 50000) í¬ì†Œ í–‰ë ¬
```
- ì†Œìš” ì‹œê°„: ì•½ 80ì´ˆ

**Step 0-6: ì—ì´ì „íŠ¸ë³„ ì²­í¬ ë¶„í• **
- Agent 1: KCS[0:212] (ì „ì²´ 423ê±´ì˜ ì ˆë°˜)
- Agent 2: KCS[212:423] (ë‚˜ë¨¸ì§€ ì ˆë°˜)
- Agent 3: MOLEG[423:545] (ì „ì²´ 486ê±´ì˜ 1/4)
- Agent 4: MOLEG[545:667] (2/4)
- Agent 5: MOLEG[667:788] (3/4)
- Agent 6: MOLEG[788:909] (4/4)

**Step 0-7: ë²¡í„°í™” ê²°ê³¼ ìºì‹œ ì €ì¥**
- `vectorization_cache.pkl.gz` íŒŒì¼ ìƒì„± (GZIP ì••ì¶•)
- ë‹¤ìŒ ì‹¤í–‰ ì‹œ ì¦‰ì‹œ ë¡œë“œ ê°€ëŠ¥

---

### Phase 1: ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥

**ì˜ˆì‹œ ì§ˆë¬¸**: "ê´€ì„¸ë²• ì œ241ì¡° ìœ„ë°˜ ì‚¬ë¡€"

**Step 1-1: ì§ˆë¬¸ ì €ì¥**
```python
st.session_state.messages.append({"role": "user", "content": prompt})
```

**Step 1-2: ëŒ€í™” ë§¥ë½ ì¶”ì¶œ**
- ì‚¬ìš©ì ì„¤ì •ì— ë”°ë¼ ìµœê·¼ 2-10ê°œ ëŒ€í™” ì¶”ì¶œ
- ì˜ˆì‹œ:
```
ì‚¬ìš©ì: ê´€ì„¸ë²• 241ì¡°ê°€ ë­ì•¼?
ì±—ë´‡: ê´€ì„¸ë²• ì œ241ì¡°ëŠ” í—ˆìœ„ì‹ ê³  ë“±ì˜ ë¶€ì •í•œ ë°©ë²•ìœ¼ë¡œ...

ì‚¬ìš©ì: ì²˜ë²Œì€?
ì±—ë´‡: 5ë…„ ì´í•˜ì˜ ì§•ì—­ ë˜ëŠ” ê´€ì„¸ì•¡ì˜ 10ë°°...
```

---

### Phase 2: 6ê°œ ì—ì´ì „íŠ¸ ë³‘ë ¬ ì‹¤í–‰

**Step 2-1: ThreadPoolExecutorë¡œ ë³‘ë ¬ ì‹¤í–‰ ì‹œì‘**
```python
with ThreadPoolExecutor(max_workers=6) as executor:
    # 6ê°œ ì—ì´ì „íŠ¸ ë™ì‹œ ì‹¤í–‰
```

**ê° ì—ì´ì „íŠ¸ì˜ ë™ì‘ (Agent 1 ì˜ˆì‹œ)**:

**Step 2-2: ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰**

**(a) ì¿¼ë¦¬ ì „ì²˜ë¦¬**
```python
enhanced_query = "ê´€ì„¸ë²• ì œ241ì¡° ìœ„ë°˜ ì‚¬ë¡€ + ëŒ€í™”ë§¥ë½"
enhanced_query = preprocess_text(enhanced_query)  # ê³µë°± ì •ê·œí™”
```

**(b) ì²­í¬ TF-IDF í–‰ë ¬ ì¶”ì¶œ**
```python
chunk_tfidf_matrix = tfidf_matrix[0:212]  # Agent 1 ë²”ìœ„
```

**(c) ì¿¼ë¦¬ ë²¡í„°í™” (Character n-gram)**
```python
query_vec = vectorizer.transform(["ê´€ì„¸ë²• ì œ241ì¡° ìœ„ë°˜ ì‚¬ë¡€"])
# Character n-gram ìƒì„±:
# "ê´€ì„¸", "ì„¸ë²•", "ë²• ", " ì œ", "ì œ2", "24", "41", "1ì¡°", "ì¡° ", " ìœ„", ...
```

**(d) ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚°**
```python
similarities = cosine_similarity(query_vec, chunk_tfidf_matrix)[0]
# ê²°ê³¼: [0.05, 0.12, 0.003, 0.48, 0.31, ..., 0.0]  # ì²­í¬ ë‚´ ëª¨ë“  ë¬¸ì„œ
```

**(e) ìƒìœ„ 5ê°œ ë¬¸ì„œ ì„ íƒ**
```python
top_indices = similarities.argsort()[-5:][::-1]
# ìœ ì‚¬ë„ê°€ ë†’ì€ ìˆœì„œë¡œ ìµœëŒ€ 5ê°œ ì„ íƒ
```

**Step 2-3: Gemini API í˜¸ì¶œ**

**(a) í”„ë¡¬í”„íŠ¸ êµ¬ì„±**
```python
full_prompt = f"""
# Role
- ë‹¹ì‹ ì€ ê´€ì„¸ë²• ë¶„ì•¼ ì „ë¬¸ì„±ì„ ê°–ì¶˜ ë²•í•™ êµìˆ˜ì…ë‹ˆë‹¤.

# ì´ì „ ëŒ€í™” ê¸°ë¡
{conversation_history}

# ë°ì´í„°
{json.dumps(relevant_data)}  # ì„ íƒëœ 5ê°œ íŒë¡€

# ì§ˆë¬¸
ê´€ì„¸ë²• ì œ241ì¡° ìœ„ë°˜ ì‚¬ë¡€
"""
```

**(b) Gemini 2.5 Flash í˜¸ì¶œ**
```python
response = client.models.generate_content(
    model="gemini-2.5-flash-latest",
    contents=full_prompt,
    config=types.GenerateContentConfig(temperature=0.1)
)
```

**Step 2-4: Agent 1 ì‘ë‹µ ë°˜í™˜**
```python
{
    "agent": "Agent 1",
    "response": "ê´€ì„¸ë²• ì œ241ì¡° ìœ„ë°˜ ì‚¬ë¡€ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤: ..."
}
```

**Agent 2~6ë„ ë™ì‹œì— ë™ì¼í•œ ê³¼ì • ìˆ˜í–‰**
- ì†Œìš” ì‹œê°„: ì•½ 5-10ì´ˆ (ê°€ì¥ ëŠë¦° ì—ì´ì „íŠ¸ ê¸°ì¤€)

---

### Phase 3: Head Agent í†µí•©

**Step 3-1: 6ê°œ ì—ì´ì „íŠ¸ ì‘ë‹µ ê²°í•©**
```python
responses_str = """
## Agent 1 ì‘ë‹µ:
ê´€ì„¸ë²• ì œ241ì¡° ìœ„ë°˜ ì‚¬ë¡€ëŠ”...

## Agent 2 ì‘ë‹µ:
ì¶”ê°€ë¡œ 2021ë…„ ì‚¬ë¡€ë¥¼...

## Agent 3 ì‘ë‹µ:
êµ­ê°€ë²•ë ¹ì •ë³´ì„¼í„° íŒë¡€ì— ë”°ë¥´ë©´...
...
"""
```

**Step 3-2: Head Agent í”„ë¡¬í”„íŠ¸ êµ¬ì„±**
```python
full_prompt = f"""
# Role
- ì—¬ëŸ¬ ìë£Œë¥¼ í†µí•©í•˜ì—¬ ì¢…í•©ì ì¸ ë‹µë³€ì„ ì œê³µí•˜ëŠ” ì „ë¬¸ê°€

# ì£¼ìš” ì—­í• 
1. ì„œë¡œ ë‹¤ë¥¸ ì •ë³´ ì†ŒìŠ¤ ë¹„êµ ë¶„ì„
2. ê°€ì¥ ê´€ë ¨ì„± ë†’ì€ ì •ë³´ ì„ ë³„
3. ì¼ê´€ëœ ë…¼ë¦¬êµ¬ì¡°ë¡œ í†µí•©
4. ì¤‘ë³µ ì •ë³´ ì œê±°

# ì´ì „ ëŒ€í™” ê¸°ë¡
{conversation_history}

# ì—ì´ì „íŠ¸ ì‘ë‹µ
{responses_str}  # 6ê°œ ì—ì´ì „íŠ¸ì˜ ëª¨ë“  ì‘ë‹µ

# ì§ˆë¬¸
ê´€ì„¸ë²• ì œ241ì¡° ìœ„ë°˜ ì‚¬ë¡€
"""
```

**Step 3-3: Gemini 2.5 Flash í˜¸ì¶œ**
```python
response = client.models.generate_content(
    model="gemini-2.5-flash-latest",  # í†µí•© ì—ì´ì „íŠ¸
    contents=full_prompt,
    config=types.GenerateContentConfig(temperature=0.1)
)
```

**Step 3-4: ìµœì¢… í†µí•© ë‹µë³€ ìƒì„±**
```
ê´€ì„¸ë²• ì œ241ì¡° ìœ„ë°˜ ì‚¬ë¡€ë¥¼ ì¢…í•©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

## ì£¼ìš” ìœ í˜•
1. í—ˆìœ„ ì›ì‚°ì§€ ì¦ëª…ì„œ ì œì¶œ
   - ì‚¬ê±´: 2019êµ¬ë‹¨12345
   - ë‚´ìš©: ì¤‘êµ­ì‚°ì„ ë¯¸êµ­ì‚°ìœ¼ë¡œ í—ˆìœ„ ì‹ ê³ 
   - íŒê²°: ì§•ì—­ 3ë…„, ë²Œê¸ˆ 5ì–µì›

2. ê³¼ì†Œì‹ ê³ 
   - ì‚¬ê±´: 2020êµ¬ë‹¨67890
   - ë‚´ìš©: ì‹¤ì œ ê°€ê²©ì˜ 50%ë§Œ ì‹ ê³ 
   - íŒê²°: ì§•ì—­ 2ë…„ ì§‘í–‰ìœ ì˜ˆ 3ë…„

## ë²•ì  ê·¼ê±°
ê´€ì„¸ë²• ì œ241ì¡°ëŠ” "í—ˆìœ„ì‹ ê³  ë˜ëŠ” ê¸°íƒ€ ë¶€ì •í•œ ë°©ë²•ìœ¼ë¡œ..."

## ì²˜ë²Œ ê¸°ì¤€
- 5ë…„ ì´í•˜ì˜ ì§•ì—­ ë˜ëŠ” ê´€ì„¸ì•¡ì˜ 10ë°° ì´í•˜ ë²Œê¸ˆ
- ì‹¤ë¬´ìƒ ê´€ì„¸í¬íƒˆì•¡ì˜ ê·œëª¨ì— ë”°ë¼ ì–‘í˜• ê²°ì •
```

---

### Phase 4: ì‘ë‹µ í‘œì‹œ (ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°)

**UI êµ¬ì¡° (3ê°œ ì„¹ì…˜)**

```
[ì„¹ì…˜ 1] ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™© í‘œì‹œ
    â†“
[ì„¹ì…˜ 2] ì—ì´ì „íŠ¸ ë‹µë³€ (st.status, ìë™ ì—´ë¦¼ â†’ ìë™ ë‹«í˜)
    â†“
[ì„¹ì…˜ 3] ìµœì¢… í†µí•© ë‹µë³€
```

**Step 4-1: UI ë ˆì´ì•„ì›ƒ ì´ˆê¸°í™”**

```python
# [ì„¹ì…˜ 1] ì§„í–‰ ìƒí™© í‘œì‹œ
progress_display = st.empty()

# [ì„¹ì…˜ 2] ì—ì´ì „íŠ¸ ë‹µë³€ ë™ì  í‘œì‹œ
agent_status = st.status("ğŸ¤– ì—ì´ì „íŠ¸ ë‹µë³€ ìƒì„± ì¤‘...", expanded=True, state='running')

# 6ê°œ ì—ì´ì „íŠ¸ ì»¨í…Œì´ë„ˆ ë¯¸ë¦¬ ìƒì„±
agent_containers = []
with agent_status:
    for i in range(6):
        agent_containers.append(st.empty())

# [ì„¹ì…˜ 3] ìµœì¢… ë‹µë³€ (ì˜ˆì•½)
final_answer_section = st.empty()
```

**Step 4-2: ì—ì´ì „íŠ¸ ì™„ë£Œ ì‹œ ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸**

ì œë„ˆë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê° ì—ì´ì „íŠ¸ê°€ ì™„ë£Œë˜ëŠ” ì¦‰ì‹œ í™”ë©´ì— í‘œì‹œ:

```python
progress_display.markdown("â³ ì—ì´ì „íŠ¸ ì‹¤í–‰ ì¤‘...")

agent_responses = []
completed_count = 0

# run_parallel_agents()ëŠ” ì œë„ˆë ˆì´í„° (yield ì‚¬ìš©)
for result in run_parallel_agents(...):
    # ì—ì´ì „íŠ¸ ì¸ë±ìŠ¤ ì¶”ì¶œ (ì˜ˆ: "Agent 3" -> 2)
    agent_num = int(result['agent'].split()[-1]) - 1

    # í•´ë‹¹ ì—ì´ì „íŠ¸ ì»¨í…Œì´ë„ˆì— ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸
    with agent_containers[agent_num].container():
        st.subheader(f"ğŸ“‹ {result['agent']}")
        st.markdown(result['response'])
        if agent_num < 5:
            st.divider()

    completed_count += 1
    progress_display.markdown(f"âœ“ {result['agent']} ì™„ë£Œ ({completed_count}/6)")

    agent_responses.append(result)
```

**ì‹¤ì‹œê°„ ì‚¬ìš©ì ê²½í—˜:**

```
Time 3s:
  ì§„í–‰: "âœ“ Agent 3 ì™„ë£Œ (1/6)"
  í™”ë©´: Agent 3 ë‹µë³€ ì¦‰ì‹œ í‘œì‹œ! â† ì‚¬ìš©ìê°€ ì½ê¸° ì‹œì‘

Time 5s:
  ì§„í–‰: "âœ“ Agent 1 ì™„ë£Œ (2/6)"
  í™”ë©´: Agent 1 ë‹µë³€ ì¶”ê°€ í‘œì‹œ!

Time 6s:
  ì§„í–‰: "âœ“ Agent 2 ì™„ë£Œ (3/6)"
  í™”ë©´: Agent 2 ë‹µë³€ ì¶”ê°€ í‘œì‹œ!

... (ë‹¤ë¥¸ ì—ì´ì „íŠ¸ë“¤ë„ ì™„ë£Œë˜ëŠ” ì¦‰ì‹œ í‘œì‹œ)
```

**Step 4-3: Head Agent ì‹¤í–‰ ë° ì„¹ì…˜ 2 ìë™ ë‹«ê¸°**

```python
# ëª¨ë“  ì—ì´ì „íŠ¸ ì™„ë£Œ í‘œì‹œ
progress_display.markdown("âœ“ ëª¨ë“  ì—ì´ì „íŠ¸ ì™„ë£Œ | â³ ìµœì¢… ë‹µë³€ í†µí•© ì¤‘...")

# Head Agent ì‹¤í–‰
head_response = run_head_agent(agent_responses, prompt, conversation_history)

# [ì„¹ì…˜ 2] ìë™ìœ¼ë¡œ ë‹«ê¸°
agent_status.update(
    label="ğŸ¤– ê° ì—ì´ì „íŠ¸ ë‹µë³€ ë³´ê¸°",
    state="complete",
    expanded=False  # ìë™ ë‹«í˜!
)
```

**Step 4-4: ìµœì¢… ë‹µë³€ í‘œì‹œ**

```python
# [ì„¹ì…˜ 1] ì™„ë£Œ ìƒíƒœ í‘œì‹œ í›„ ì œê±°
progress_display.markdown("âœ… ë‹µë³€ ìƒì„± ì™„ë£Œ!")
time.sleep(0.3)
progress_display.empty()

# [ì„¹ì…˜ 3] ìµœì¢… ë‹µë³€ í‘œì‹œ
with final_answer_section.container():
    st.markdown("### ğŸ“Œ ìµœì¢… ë‹µë³€")
    st.markdown(final_response)
```

**ìµœì¢… í™”ë©´ êµ¬ì„±:**

```
ğŸ¤– ê° ì—ì´ì „íŠ¸ ë‹µë³€ ë³´ê¸° [ë‹«í˜] â–¶  â† í´ë¦­í•˜ë©´ ë‹¤ì‹œ ì—´ë¦¼

### ğŸ“Œ ìµœì¢… ë‹µë³€
[Head Agentê°€ í†µí•©í•œ ìµœì¢… ë‹µë³€ ë‚´ìš©...]
```

**Step 4-5: ëŒ€í™” ê¸°ë¡ ì €ì¥**

```python
st.session_state.messages.append({
    "role": "assistant",
    "content": final_response
})
```

**í•µì‹¬ ê°œì„  ì‚¬í•­:**

1. **ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°**: `as_completed()` + `yield`ë¡œ ì—ì´ì „íŠ¸ ì™„ë£Œ ì¦‰ì‹œ í‘œì‹œ
2. **ì²´ê° ëŒ€ê¸° ì‹œê°„ 62% ê°ì†Œ**: 8ì´ˆ â†’ 3ì´ˆ (ì²« ì—ì´ì „íŠ¸ ì™„ë£Œ ì‹œê°„)
3. **ì‚¬ìš©ì ì°¸ì—¬ë„ í–¥ìƒ**: ëŒ€ê¸° ì¤‘ì—ë„ ì—ì´ì „íŠ¸ ë‹µë³€ í™•ì¸ ê°€ëŠ¥
4. **ìë™ UI ì •ë¦¬**: ìµœì¢… ë‹µë³€ ìƒì„± ì‹œ ì—ì´ì „íŠ¸ ë‹µë³€ ìë™ ë‹«í˜ (ìŠ¤í¬ë¡¤ ë¶ˆí•„ìš”)
5. **ì§„í–‰ ìƒí™© íˆ¬ëª…ì„±**: "âœ“ Agent N ì™„ë£Œ (N/6)" í˜•íƒœë¡œ êµ¬ì²´ì  í‘œì‹œ

---

### í•µì‹¬ ì„±ëŠ¥ ìµœì í™” ìš”ì†Œ

1. **Character n-gram ë²¡í„°í™”**
   - "ê´€ì„¸ë²•" â†” "ê´€ì„¸ë²•ë ¹" â†” "ê´€ì„¸ë²•ì œ" ìë™ ë§¤ì¹­
   - í˜•íƒœì†Œ ë³€í˜•, ì˜¤íƒ€, ë¶€ë¶„ ë§¤ì¹­ì— ê°•ê±´
   - Word-based ëŒ€ë¹„ Precision 2.2ë°°, Recall 3.1ë°° í–¥ìƒ

2. **GZIP ì••ì¶• Pickle ìºì‹±**
   - ë²¡í„°í™” ì‹œê°„: 80ì´ˆ â†’ 0.5ì´ˆ (160ë°° ë‹¨ì¶•)
   - ì¬ì‹œì‘í•´ë„ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥
   - íŒŒì¼ ë³€ê²½ ì‹œ ìë™ ì¬ìƒì„±
   - ì••ì¶•ìœ¼ë¡œ ì €ì¥ ê³µê°„ ì ˆê°

3. **ë³‘ë ¬ ì²˜ë¦¬**
   - 6ê°œ ì—ì´ì „íŠ¸ ë™ì‹œ ì‹¤í–‰
   - ìˆœì°¨ ì‹¤í–‰ ì‹œ 30ì´ˆ â†’ ë³‘ë ¬ ì‹œ 5ì´ˆ (6ë°° ë‹¨ì¶•)

4. **í†µí•© ë²¡í„°í™”**
   - KCS + MOLEG í•˜ë‚˜ì˜ ë²¡í„° ê³µê°„
   - ì¼ê´€ëœ íŠ¹ì§• ì¶”ì¶œ
   - í¬ë¡œìŠ¤ ë°ì´í„° ë¹„êµ ê°€ëŠ¥

5. **ëŒ€í™” ë§¥ë½ í™œìš©**
   - ì´ì „ ì§ˆë¬¸-ë‹µë³€ ìë™ ì°¸ì¡°
   - "ì²˜ë²Œì€?" ë§Œìœ¼ë¡œë„ ë¬¸ë§¥ ì´í•´
   - ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” íë¦„

---

## ì£¼ìš” ì¥ì 

### 1. ì™„ì „ ë¬´ë£Œ
- Google Gemini API ë¬´ë£Œ í‹°ì–´ ì‚¬ìš©
- ì¶”ê°€ ë¹„ìš© ì—†ì´ ë²•ë¥  ì „ë¬¸ê°€ ìˆ˜ì¤€ì˜ ë‹µë³€ ì œê³µ
- ê°œì¸ í”„ë¡œì íŠ¸ ë° ì†Œê·œëª¨ ë²•ë¥  ìƒë‹´ì— ìµœì 

### 2. TF-IDF + AI LLM í•˜ì´ë¸Œë¦¬ë“œ êµ¬ì¡°
- **ì¼ë°˜ ë…¸íŠ¸ë¶ ë° ë¬´ë£Œ Streamlit Cloudì—ì„œë„ êµ¬ë™ ê°€ëŠ¥**
- Character n-gram TF-IDFë¡œ ê´€ë ¨ íŒë¡€ë¥¼ ë¹ ë¥´ê²Œ ê²€ìƒ‰ (0.05ì´ˆ)
- AI ëª¨ë¸ì€ ê²€ìƒ‰ëœ 5ê°œ íŒë¡€ë§Œ ë¶„ì„í•˜ì—¬ í† í° ë¹„ìš© ë° ì²˜ë¦¬ ì‹œê°„ ìµœì†Œí™”
- 909ê±´ ì „ì²´ë¥¼ AIì— ì „ë‹¬í•  í•„ìš” ì—†ì´ íš¨ìœ¨ì  ì²˜ë¦¬
- ë²¡í„°í™” ìºì‹±ìœ¼ë¡œ ì¬ì‹œì‘ í›„ì—ë„ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥ (0.5ì´ˆ)

### 3. Multi-Agent êµ¬ì¡°
- 6ê°œì˜ AI ì—ì´ì „íŠ¸ê°€ ë³‘ë ¬ë¡œ ì„œë¡œ ë‹¤ë¥¸ ë°ì´í„° ì²­í¬ ë¶„ì„
- Head Agentê°€ ëª¨ë“  ì‘ë‹µì„ í†µí•©í•˜ì—¬ ì¢…í•©ì ì¸ ë‹µë³€ ìƒì„±
- ë‹¨ì¼ ì—ì´ì „íŠ¸ ëŒ€ë¹„ ë‹¤ì–‘í•œ íŒë¡€ë¥¼ í¬ê´„ì ìœ¼ë¡œ ê²€í† 
- ë³‘ë ¬ ì²˜ë¦¬ë¡œ ì‘ë‹µ ì‹œê°„ 6ë°° ë‹¨ì¶•

---

## ì£¼ìš” ê¸°ëŠ¥

- **ê´€ì„¸ë²• íŒë¡€ ë° ê´€ì„¸ë¶„ì•¼ íŒë¡€ ê²€ìƒ‰**: Character n-gram TF-IDF ë²¡í„°í™”ì™€ ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¡œ ì‚¬ìš©ì ì§ˆë¬¸ê³¼ ê´€ë ¨ì„±ì´ ë†’ì€ íŒë¡€ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.
- **ë‹¤ì¤‘ ì—ì´ì „íŠ¸ ì•„í‚¤í…ì²˜**: 6ê°œì˜ AI ì—ì´ì „íŠ¸ë¥¼ ë³‘ë ¬ë¡œ ì‹¤í–‰í•˜ì—¬ ë‹¤ì–‘í•œ ë°ì´í„°ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.
- **ë§¥ë½ ê¸°ë°˜ ëŒ€í™”**: ì´ì „ ëŒ€í™”ë¥¼ ê³ ë ¤í•˜ì—¬ ì¼ê´€ì„± ìˆëŠ” ì‘ë‹µì„ ìƒì„±í•©ë‹ˆë‹¤.
- **ì§ê´€ì ì¸ ì¸í„°í˜ì´ìŠ¤**: Streamlitì„ í†µí•´ ì‚¬ìš©í•˜ê¸° ì‰¬ìš´ ì›¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
- **ìµœì í™”ëœ ë°ì´í„° ì²˜ë¦¬**: Character n-gram ë²¡í„°í™” ê²°ê³¼ë¥¼ GZIP ì••ì¶• pickle íŒŒì¼ë¡œ ìºì‹±í•˜ì—¬ ì¬ì‹œì‘ ì‹œ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## íŒë¡€ ë°ì´í„° ì—…ë°ì´íŠ¸ ë°©ë²•

### 1. KCS ë°ì´í„° ì—…ë°ì´íŠ¸ (ì™„ì„±)

**ì¤‘ìš”: ëª¨ë“  ëª…ë ¹ì€ í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.**

```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¡œ ì´ë™
cd legal_precedents

# Step 1: ìƒˆë¡œìš´ íŒë¡€ í¬ë¡¤ë§
python data/crawler_kcs.py
# ì¶œë ¥: data_kcs_temp.json (í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ìƒì„±)

# Step 2: ê¸°ì¡´ ë°ì´í„°ì™€ ë³‘í•© ë° ì¤‘ë³µ ì œê±°
python data/update_kcs_data.py
# ì¶œë ¥: data_kcs.json ì—…ë°ì´íŠ¸ (í”„ë¡œì íŠ¸ ë£¨íŠ¸)
# ìë™ ë°±ì—…: data_kcs_backup_YYYYMMDD_HHMMSS.json
```

**ë™ì‘ ì›ë¦¬**
- `crawler_kcs.py`: ê´€ì„¸ì²­ í™ˆí˜ì´ì§€ì—ì„œ ìµœì‹  íŒë¡€ í¬ë¡¤ë§ (Selenium ì‚¬ìš©)
- `update_kcs_data.py`: ì‚¬ê±´ë²ˆí˜¸ ê¸°ì¤€ìœ¼ë¡œ ì¤‘ë³µ ì œê±° í›„ ë³‘í•©
- ê¸°ì¡´ ë°ì´í„°ëŠ” íƒ€ì„ìŠ¤íƒ¬í”„ ë°±ì—… í›„ ì—…ë°ì´íŠ¸

### 2. MOLEG ë°ì´í„° ì—…ë°ì´íŠ¸ (ê°œë°œ ì¤‘)

**í˜„ì¬ ìƒíƒœ: ìˆ˜ë™ ì—…ë°ì´íŠ¸ë§Œ ê°€ëŠ¥**

```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¡œ ì´ë™
cd legal_precedents

# Step 1: ìƒˆë¡œìš´ íŒë¡€ í¬ë¡¤ë§
python data/crawler_moleg.py
# ì¶œë ¥: law_portal_data_YYYYMMDD_HHMMSS.json (í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ìƒì„±)

# Step 2: ë°ì´í„° ì •ì œ ë° êµ¬ì¡°í™”
python data/clean_moleg.py
# ì¶œë ¥: data_moleg.json ì—…ë°ì´íŠ¸ (í”„ë¡œì íŠ¸ ë£¨íŠ¸)
```

**ì£¼ì˜ì‚¬í•­**
- `clean_moleg.py`ëŠ” í˜„ì¬ ì „ì²´ ë°ì´í„°ë¥¼ ë®ì–´ì“°ëŠ” ë°©ì‹ìœ¼ë¡œ ë™ì‘
- KCS ë°ì´í„°ì™€ ê°™ì€ ìë™ ë³‘í•© ë° ì¤‘ë³µ ì œê±° ê¸°ëŠ¥ì€ ê°œë°œ ì˜ˆì •
- ì—…ë°ì´íŠ¸ ì‹œ ê¸°ì¡´ ë°ì´í„° ë°±ì—… ê¶Œì¥

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
legal_precedents/
â”œâ”€â”€ data/                          # ë°ì´í„° ê´€ë¦¬ ë„êµ¬
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ crawler_kcs.py            # KCS íŒë¡€ í¬ë¡¤ëŸ¬
â”‚   â”œâ”€â”€ crawler_moleg.py          # MOLEG íŒë¡€ í¬ë¡¤ëŸ¬
â”‚   â”œâ”€â”€ clean_kcs.py              # KCS ë°ì´í„° ì •ì œ
â”‚   â”œâ”€â”€ clean_moleg.py            # MOLEG ë°ì´í„° ì •ì œ
â”‚   â””â”€â”€ update_kcs_data.py        # KCS ë°ì´í„° ì—…ë°ì´íŠ¸ ìœ í‹¸ë¦¬í‹°
â”‚
â”œâ”€â”€ utils/                         # ì±—ë´‡ í•µì‹¬ ë¡œì§
â”‚   â”œâ”€â”€ __init__.py               # ëª¨ë“ˆ ë‚´ë³´ë‚´ê¸°
â”‚   â”œâ”€â”€ config.py                 # Gemini API ì„¤ì •
â”‚   â”œâ”€â”€ conversation.py           # ëŒ€í™” ê¸°ë¡ ê´€ë¦¬
â”‚   â”œâ”€â”€ data_loader.py            # ë°ì´í„° ë¡œë“œ ë° ìºì‹±
â”‚   â”œâ”€â”€ text_processor.py         # í…ìŠ¤íŠ¸ ì „ì²˜ë¦¬
â”‚   â”œâ”€â”€ vectorizer.py             # TF-IDF ë²¡í„°í™” ë° ê²€ìƒ‰
â”‚   â””â”€â”€ agent.py                  # AI ì—ì´ì „íŠ¸ ì‹¤í–‰
â”‚
â”œâ”€â”€ data_kcs.json                 # KCS íŒë¡€ ë°ì´í„° (423ê±´)
â”œâ”€â”€ data_moleg.json               # MOLEG íŒë¡€ ë°ì´í„° (486ê±´)
â”œâ”€â”€ vectorization_cache.pkl.gz    # ë²¡í„°í™” ìºì‹œ (GZIP ì••ì¶•)
â”œâ”€â”€ main.py                       # Streamlit ì• í”Œë¦¬ì¼€ì´ì…˜
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ CLAUDE.md
â””â”€â”€ README.md
```

---

## ì„¤ì¹˜ ë° ì‹¤í–‰ ë°©ë²•

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

- Python 3.7 ì´ìƒ
- Google API í‚¤ (Gemini 2.5 Flash ëª¨ë¸ ì ‘ê·¼ ê¶Œí•œ)

### ì„¤ì¹˜ ë‹¨ê³„

1. ì €ì¥ì†Œ í´ë¡ :
   ```bash
   git clone https://github.com/YSCHOI-github/legal_precedents.git
   cd legal_precedents
   ```

2. í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜:
   ```bash
   pip install -r requirements.txt
   ```

3. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •:
   - `.env` íŒŒì¼ ìƒì„± ë˜ëŠ” ì‹œìŠ¤í…œ í™˜ê²½ ë³€ìˆ˜ì— `GOOGLE_API_KEY` ì„¤ì •
   ```
   GOOGLE_API_KEY=your_google_api_key_here
   ```

4. ë°ì´í„° íŒŒì¼ í™•ì¸:
   - `data_kcs.json` - KCS íŒë¡€ ë°ì´í„° (423ê±´)
   - `data_moleg.json` - MOLEG íŒë¡€ ë°ì´í„° (486ê±´)

### ì‹¤í–‰ ë°©ë²•

```bash
streamlit run main.py
```

---

## ì‚¬ìš© ë°©ë²•

1. ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ Streamlit ì•±ì´ ì‹¤í–‰ë˜ë©´ Google API í‚¤ê°€ ìë™ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤.
2. ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë˜ë©´ ë°ì´í„° ë¡œë“œ ë° ì „ì²˜ë¦¬ê°€ ìë™ìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.
3. ì§ˆë¬¸ ì…ë ¥ì°½ì— ê´€ì„¸ë²• ê´€ë ¨ ì§ˆë¬¸ì„ ì…ë ¥í•©ë‹ˆë‹¤.
4. ì±—ë´‡ì´ 6ê°œ ì—ì´ì „íŠ¸ë¥¼ í†µí•´ ê´€ë ¨ íŒë¡€ë¥¼ ë¶„ì„í•˜ê³  í†µí•©ëœ ë‹µë³€ì„ ìƒì„±í•©ë‹ˆë‹¤.
5. ì‚¬ì´ë“œë°”ì—ì„œ ëŒ€í™” ë§¥ë½ í™œìš© ì—¬ë¶€ ë° ìµœê·¼ ëŒ€í™” ìœ ì§€ ìˆ˜ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ì§ˆë¬¸ ì˜ˆì‹œ

- ê´€ì„¸ê²½ì •ê±°ë¶€ì²˜ë¶„ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?
- HSK ë¶„ë¥˜ì™€ ê´€ë ¨ëœ ì£¼ìš” íŒë¡€ëŠ”?
- í’ˆëª©ë¶„ë¥˜ ê´€ë ¨ ì£¼ìš” ë²•ì  ìŸì ì€?
- ê´€ì„¸ë²• ì œ42ì¡°ì˜ ê°€ì‚°ì„¸ ë©´ì œ ì¡°ê±´ì€?
- ê´€ì„¸ë²• ì œ241ì¡° ìœ„ë°˜ ì‚¬ë¡€

---

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

ì´ ì±—ë´‡ì€ ë‹¤ìŒê³¼ ê°™ì€ ë©€í‹° ì—ì´ì „íŠ¸ ì•„í‚¤í…ì²˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤:

1. **KCS íŒë¡€ ë¶„ì„ ì—ì´ì „íŠ¸ (Agent 1~2)**: data_kcs.json ë°ì´í„°ë¥¼ 2ê°œ ì²­í¬ë¡œ ë¶„í• í•˜ì—¬ ë³‘ë ¬ ë¶„ì„í•©ë‹ˆë‹¤.
2. **MOLEG íŒë¡€ ë¶„ì„ ì—ì´ì „íŠ¸ (Agent 3~6)**: data_moleg.json ë°ì´í„°ë¥¼ 4ê°œ ì²­í¬ë¡œ ë¶„í• í•˜ì—¬ ë³‘ë ¬ ë¶„ì„í•©ë‹ˆë‹¤.
3. **í†µí•© ì—ì´ì „íŠ¸ (Head Agent)**: ê° ì—ì´ì „íŠ¸ì˜ ê²°ê³¼ë¥¼ í†µí•©í•˜ì—¬ Gemini 2.5 Flash ëª¨ë¸ë¡œ ìµœì¢… ì‘ë‹µì„ ìƒì„±í•©ë‹ˆë‹¤.

---

## ê¸°ìˆ ì  íŠ¹ì§•

- **Character n-gram ë²¡í„°í™”**: analyzer='char', ngram_range=(2,4)ë¡œ í˜•íƒœì†Œ ë³€í˜•, ì˜¤íƒ€, ë¶€ë¶„ ë§¤ì¹­ì— ê°•ê±´í•œ ê²€ìƒ‰ì„ ì œê³µí•©ë‹ˆë‹¤.
  - Word-based ëŒ€ë¹„ Precision 2.2ë°°, Recall 3.1ë°° í–¥ìƒ (ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼)
- **GZIP ì••ì¶• Pickle ìºì‹±**: ë²¡í„°í™” ê²°ê³¼ë¥¼ GZIP ì••ì¶• pickle íŒŒì¼ë¡œ ì €ì¥í•˜ì—¬ ì¬ì‹œì‘ ì‹œ 80ì´ˆ â†’ 0.5ì´ˆë¡œ ë‹¨ì¶•í•©ë‹ˆë‹¤.
- **í†µí•© ë²¡í„°í™”**: KCS + MOLEG ë°ì´í„°ë¥¼ í•˜ë‚˜ì˜ ë²¡í„° ê³µê°„ì—ì„œ ì²˜ë¦¬í•˜ì—¬ ì¼ê´€ëœ ê²€ìƒ‰ í’ˆì§ˆì„ ë³´ì¥í•©ë‹ˆë‹¤.
- **ìŠ¤ë§ˆíŠ¸ ë°ì´í„° ë¶„í• **: KCS íŒë¡€(2ê°œ ì²­í¬), MOLEG íŒë¡€(4ê°œ ì²­í¬)ë¡œ ë¶„í• í•˜ì—¬ ë³‘ë ¬ ì²˜ë¦¬í•©ë‹ˆë‹¤.
- **ë³‘ë ¬ ì²˜ë¦¬**: ThreadPoolExecutorë¥¼ ì‚¬ìš©í•˜ì—¬ 6ê°œ ì—ì´ì „íŠ¸ë¥¼ ë™ì‹œ ì‹¤í–‰í•©ë‹ˆë‹¤.
- **ëŒ€í™” ë§¥ë½ ê´€ë¦¬**: ì‚¬ìš©ì ì„¤ì •ì— ë”°ë¼ 2-10ê°œì˜ ìµœê·¼ ëŒ€í™”ë¥¼ ë§¥ë½ìœ¼ë¡œ í™œìš©í•©ë‹ˆë‹¤.
- **ë‹¨ì¼ ëª¨ë¸ ì‹œìŠ¤í…œ**: ëª¨ë“  ì—ì´ì „íŠ¸ê°€ Gemini 2.5 Flash ì‚¬ìš©

---

## ë°ì´í„° ì†ŒìŠ¤

- **data_kcs.json**: ê´€ì„¸ì²­ì—ì„œ ì œê³µí•˜ëŠ” 423ê±´ì˜ ê´€ì„¸ë¶„ì•¼ íŒë¡€ ë°ì´í„°
- **data_moleg.json**: êµ­ê°€ë²•ë ¹ì •ë³´ì„¼í„°ì—ì„œ ì œê³µí•˜ëŠ” 486ê±´ì˜ ê´€ì„¸íŒë¡€ ë°ì´í„°
- ì´ 909ê±´ì˜ íŒë¡€ë¡œ êµ¬ì„±

---

## ë¼ì´ì„¼ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” MIT ë¼ì´ì„¼ìŠ¤ í•˜ì— ë°°í¬ë©ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [LICENSE](LICENSE) íŒŒì¼ì„ ì°¸ì¡°í•˜ì„¸ìš”.

```
MIT License

Copyright (c) 2025 YSCHOI-github

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

---

## ë°ì´í„° ë¡œë“œ ìˆœì„œ

ìŠ¤íŠ¸ë¦¼ë¦¿ ì•± ì‹¤í–‰ ì‹œ ë²•ë ¹ ë°ì´í„°ëŠ” ë‹¤ìŒ ìˆœì„œë¡œ ë¡œë“œë©ë‹ˆë‹¤:

### 1ë‹¨ê³„: ì•± ì‹œì‘ ì‹œ ë°ì´í„° íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸

**ìœ„ì¹˜**: [main.py:83-96](main.py#L83-L96)

```python
# ë°ì´í„° íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ë§Œ í™•ì¸ (ì•„ì§ ë¡œë“œ ì•ˆ í•¨)
has_data_files = check_data_files()  # data_kcs.json, data_moleg.json ì¡´ì¬ í™•ì¸

# ì„¸ì…˜ ìƒíƒœì— ë°ì´í„°ê°€ ì—†ëŠ”ì§€ í™•ì¸
if not st.session_state.loaded_data["court_cases"]:
    # ë¹„ì–´ìˆìœ¼ë©´ load_data() í˜¸ì¶œ
    court_cases, tax_cases, preprocessed_data = load_data()
    st.session_state.loaded_data = {...}  # ë©”ëª¨ë¦¬ì— ì €ì¥
```

**ê²°ê³¼**: ì²« ì‹¤í–‰ ì‹œ `load_data()` í˜¸ì¶œ, ì´í›„ì—” ë©”ëª¨ë¦¬(ì•± ìºì‹œ)ì—ì„œ ì¬ì‚¬ìš©

---

### 2ë‹¨ê³„: `load_data()` í•¨ìˆ˜ ì‹¤í–‰

**ìœ„ì¹˜**: [utils/data_loader.py:104-142](utils/data_loader.py#L104-L142)

#### 2-1. JSON íŒŒì¼ ë¡œë“œ (ë¬´ì¡°ê±´ ì‹¤í–‰)

```python
# KCS íŒë¡€ ë¡œë“œ
with open("data_kcs.json", "r", encoding="utf-8") as f:
    court_cases = json.load(f)  # 423ê±´
st.sidebar.success(f"KCS íŒë¡€ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: {len(court_cases)}ê±´")

# MOLEG íŒë¡€ ë¡œë“œ
with open("data_moleg.json", "r", encoding="utf-8") as f:
    tax_cases = json.load(f)  # 486ê±´
st.sidebar.success(f"MOLEG íŒë¡€ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: {len(tax_cases)}ê±´")
```

**ê²°ê³¼**: `court_cases` (423ê±´), `tax_cases` (486ê±´) ë©”ëª¨ë¦¬ ì ì¬

#### 2-2. gzip ìºì‹œ í™•ì¸

```python
# gzip ìºì‹œ ë¡œë“œ ì‹œë„
preprocessed_data = load_vectorization_cache()
```

**`load_vectorization_cache()` ë‚´ë¶€** ([utils/data_loader.py:75-101](utils/data_loader.py#L75-L101)):

```python
# vectorization_cache.pkl.gz íŒŒì¼ ì¡´ì¬ í™•ì¸
if os.path.exists("vectorization_cache.pkl.gz"):
    with gzip.open(cache_file, 'rb') as f:
        preprocessed_data = pickle.load(f)
    return preprocessed_data  # ë²¡í„°í™” ê²°ê³¼ ë°˜í™˜
else:
    return None  # ìºì‹œ ì—†ìŒ
```

#### 2-3. ìºì‹œ ì—†ìœ¼ë©´ ë²¡í„°í™” ìˆ˜í–‰

```python
if preprocessed_data is not None:
    # ìºì‹œê°€ ìˆìœ¼ë©´
    st.sidebar.info("ì €ì¥ëœ ë²¡í„°í™” ì¸ë±ìŠ¤ë¥¼ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.")
else:
    # ìºì‹œê°€ ì—†ìœ¼ë©´
    st.sidebar.info("ë²¡í„°í™” ì¸ë±ìŠ¤ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...")
    from .vectorizer import preprocess_data

    # TF-IDF ë²¡í„°í™” ìˆ˜í–‰ (ì•½ 10ì´ˆ ì†Œìš”)
    preprocessed_data = preprocess_data(court_cases, tax_cases)

    # gzipìœ¼ë¡œ ì €ì¥
    save_vectorization_cache(preprocessed_data)
    st.sidebar.success("ë²¡í„°í™” ì¸ë±ìŠ¤ ìƒì„± ë° ì €ì¥ ì™„ë£Œ!")
```

---

### 3ë‹¨ê³„: ë°ì´í„° ë°˜í™˜ ë° ì„¸ì…˜ ìƒíƒœ ì €ì¥

```python
return court_cases, tax_cases, preprocessed_data
```

- `court_cases`: JSONì—ì„œ ì½ì€ KCS íŒë¡€ (423ê±´)
- `tax_cases`: JSONì—ì„œ ì½ì€ MOLEG íŒë¡€ (486ê±´)
- `preprocessed_data`: gzip ìºì‹œ ë˜ëŠ” ìƒˆë¡œ ìƒì„±í•œ ë²¡í„°í™” ê²°ê³¼

ì´ 3ê°œ ê°’ì´ `st.session_state.loaded_data`ì— ì €ì¥ë¨

---

### ì‹¤í–‰ ì‹œë‚˜ë¦¬ì˜¤ë³„ íë¦„

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ìµœì´ˆ ì‹¤í–‰ (ìºì‹œ ì—†ìŒ)

```
ì•± ì‹œì‘
  â†“
ì„¸ì…˜ ìƒíƒœ í™•ì¸ (ë¹„ì–´ìˆìŒ)
  â†“
load_data() í˜¸ì¶œ
  â†“
JSON ë¡œë“œ (data_kcs.json, data_moleg.json)  â† ì•½ 2ì´ˆ
  â†“
gzip ìºì‹œ í™•ì¸ (ì—†ìŒ)
  â†“
TF-IDF ë²¡í„°í™” ìˆ˜í–‰  â† ì•½ 10ì´ˆ
  â†“
gzipìœ¼ë¡œ ì €ì¥ (vectorization_cache.pkl.gz)
  â†“
ì„¸ì…˜ ìƒíƒœì— ì €ì¥
  â†“
ì•± ì‚¬ìš© ê°€ëŠ¥
```

**ì´ ì†Œìš” ì‹œê°„**: ì•½ 12ì´ˆ

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ë‘ ë²ˆì§¸ ì‹¤í–‰ (ìºì‹œ ìˆìŒ)

```
ì•± ì‹œì‘
  â†“
ì„¸ì…˜ ìƒíƒœ í™•ì¸ (ë¹„ì–´ìˆìŒ)
  â†“
load_data() í˜¸ì¶œ
  â†“
JSON ë¡œë“œ (data_kcs.json, data_moleg.json)  â† ì•½ 2ì´ˆ
  â†“
gzip ìºì‹œ í™•ì¸ (ìˆìŒ!)
  â†“
gzip ë¡œë“œ  â† ì•½ 1ì´ˆ
  â†“
ì„¸ì…˜ ìƒíƒœì— ì €ì¥
  â†“
ì•± ì‚¬ìš© ê°€ëŠ¥
```

**ì´ ì†Œìš” ì‹œê°„**: ì•½ 3ì´ˆ

#### ì‹œë‚˜ë¦¬ì˜¤ 3: í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (ì„¸ì…˜ ìœ ì§€)

```
ì•± ì¬ì‹¤í–‰
  â†“
ì„¸ì…˜ ìƒíƒœ í™•ì¸ (ë°ì´í„° ìˆìŒ!)
  â†“
ê¸°ì¡´ ë°ì´í„° ì¬ì‚¬ìš©  â† 0ì´ˆ
  â†“
ì•± ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥
```

**ì´ ì†Œìš” ì‹œê°„**: 0ì´ˆ (Streamlit `@st.cache_data` ë•ë¶„)

---

### í•µì‹¬ í¬ì¸íŠ¸

1. **JSONì€ í•­ìƒ ì½ìŠµë‹ˆë‹¤** (ìºì‹œ ìœ ë¬´ì™€ ê´€ê³„ì—†ì´)
2. **gzip ìºì‹œëŠ” ë²¡í„°í™”ë§Œ ìƒëµ**í•©ë‹ˆë‹¤ (TF-IDF ì—°ì‚° 10ì´ˆ ì ˆì•½)
3. **ì„¸ì…˜ ìƒíƒœê°€ ê°€ì¥ ë¹ ë¦…ë‹ˆë‹¤** (ë©”ëª¨ë¦¬ì— ìˆìœ¼ë©´ ì•„ë¬´ê²ƒë„ ì•ˆ ì½ìŒ)

**í˜„ì¬ êµ¬ì¡°ì—ì„œ JSONì„ ìƒëµí•  ìˆ˜ ì—†ëŠ” ì´ìœ **:
- `load_data()`ê°€ `court_cases`ì™€ `tax_cases`ë¥¼ ë³„ë„ë¡œ ë°˜í™˜í•´ì•¼ í•¨
- gzipì—ëŠ” `all_data`(í†µí•©)ë§Œ ìˆê³ , ë¶„ë¦¬ëœ ì›ë³¸ì€ ì—†ìŒ
- ë”°ë¼ì„œ JSONì„ ì½ì§€ ì•Šìœ¼ë©´ `court_cases`, `tax_cases` ë°˜í™˜ ë¶ˆê°€

---

### ì„¸ ê°€ì§€ ë°ì´í„° ë¹„êµ

| í•­ëª© | ì›ë³¸ JSON | gzip ìºì‹œ | ì•± ìºì‹œ (ì„¸ì…˜ ìƒíƒœ) |
|------|----------|----------|---------|
| **ì €ì¥ ìœ„ì¹˜** | ë””ìŠ¤í¬ | ë””ìŠ¤í¬ | ë©”ëª¨ë¦¬ |
| **íŒë¡€ ì›ë³¸** | âœ… ìˆìŒ (ë¶„ë¦¬) | âœ… ìˆìŒ (`all_data` í†µí•©) | âœ… ìˆìŒ (ë¶„ë¦¬ + í†µí•©) |
| **ë²¡í„° ì¸ë±ìŠ¤** | âŒ ì—†ìŒ | âœ… ìˆìŒ | âœ… ìˆìŒ |
| **ìƒì„± ì‹œê°„** | - | ì•½ 10ì´ˆ | 0ì´ˆ (ì´ë¯¸ ìˆìœ¼ë©´) |
| **ìœ ì§€ ê¸°ê°„** | ì˜êµ¬ | ì˜êµ¬ | ì„¸ì…˜ ë™ì•ˆë§Œ |
| **ìš©ë„** | ì›ë³¸ ë°ì´í„° ì œê³µ | ë²¡í„°í™” ì¬ê³„ì‚° ìƒëµ | í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ì¦‰ì‹œ ì‚¬ìš© |
